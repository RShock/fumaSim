# 如果你想添加角色 (2022/5/1)
## 概论
总的来说，如果需要添加新的角色，需要：
1. 添加新的角色
2. 添加角色技能并将其与对应角色绑定

## 添加角色
我们将以添加一个新角色作为实例，来引导如何添加一个新的角色，以下将以添加"机灵古怪 塞露西亚"作为例子：

| 角色名 | 昵称 | ID | 属性 | 职业  | 类型  | 稀有度 | 攻击力 | 生命值 | 图片 | 图鉴攻击力 | 图鉴生命力 |
|-----|----|---|---|-----|-----|-----|-----|-----|-------------|-----------|-------------|
| 机灵古怪 塞露西亚 | 幼精 | 1 |风属性| 攻击者 | 限定角 | SSR | 1016 | 3470.4 | 机灵古怪_塞露西亚.png | 281230.3143 | 960611.8926 |

由例子可见，一个角色共有角色名、昵称、ID、属性等12种属性，我们需要将其一一填入之中，对于每种属性的含义与取值，将会在如下做更详细的解释。

### 1. 角色名
顾名思义为角色的名称

### 2. 昵称
角色的昵称

### 3. ID
角色的ID，与技能ID绑定，**不能重复！**

### 4. 属性
角色的属性，现支持的属性如下：
1. 水属性
2. 风属性
3. 光属性
4. 暗属性
5. 火属性

### 5. 职业
角色的职业，现支持的职业如下：
1. 攻击者
2. 守护者
3. 辅助者
4. 妨碍者
5. 治疗者

### 6. 类型
角色的类型，现支持的类型如下：
1. 常驻角：即常驻池中的角色
2. 限定角：限定活动才会出现在池中的角色

### 7. 稀有度
角色的稀有度，现支持的类型如下：
1. SSR
2. SR
3. R
4. N

### 8. 攻击力
角色在（LV=1，星=3(SSR)/2(SR)/1(R)/0(N)，花=1）时的攻击力，由 *图鉴攻击力/1.1^59* 获得。

### 9. 生命值
角色在（LV=1，星=3(SSR)/2(SR)/1(R)/0(N)，花=1）时的生命值，由 *图鉴攻击力/1.1^59* 获得。

### 10. 图片
角色的缩略图

### 11. 图鉴攻击力
角色的图鉴攻击力，为角色在（LV=60，星=3(SSR)/2(SR)/1(R)/0(N)，花=1）时的攻击力。

### 12. 图鉴生命值
角色的图鉴生命值，为角色在（LV=60，星=3(SSR)/2(SR)/1(R)/0(N)，花=1）时的生命值。

## 添加角色技能
所有的技能都将通过TriggerManager注册，被放入技能池中。与添加新角色类似，我们将通过引入"如何添加一个新的技能"来帮助理解绑定技能到角色，以下将用"机灵古怪 塞露西亚的1001"技能作为例子。

| 技能所属者     | ID   | 类型  | 类型2 | 描述（人话）                              | 触发时点 | 描述（程序语言） |
|-----------|------|-----|----|-------------------------------------|------|----------|
| 机灵古怪 塞露西亚 | 1001 | 必杀技 | 1绊 | 以自身攻击力330%对目标造成伤害，再使自身攻击力增加20%（3回合） | 释放必杀 | 对目标330%技能伤害,自身攻击力+20%(3回合) |

由例子可见，一个角色技能共有技能所属者，ID，类型，类型2等7种属性。

### 1. 技能所属者
顾名思义就是需要绑定的角色名

### 2. ID
ID的千位上是角色的ID，如："技能ID1001-角色ID1", "技能ID43034-角色ID43"。 ID的最后三位为技能的ID。  
*注意：技能千位上的角色ID必须与角色表格中的ID一致*

### 3. 类型
技能类型由<类型>和<类型2>共同决定，<类型>为技能的实际类型，<类型2>提供技能的等级
目前FumaSim实装的在天下布魔中存在的技能如下：
1. 必杀技
2. 队长技
3. 被动
4. 普攻
5. 防御
6. 动态技能

**必杀技**和**被动**将存在等级之分，如不同绊数会启用不同的技能，角色不同的星级与潜力也会启用不同的技能。  
**队长技**只会在角色作为队长（1号位）的时候启用。  
**普攻**和**防御**分别只会在角色进行普攻和防御动作的时候启用。  
**动态技能**是一种由角色技能产生出来的新技能（新效果）。以技能"1011"和"1018"作为例子：技能"1011"的描述为"使精灵王赛鲁西亚获得必杀后 触发目标受到伤害增加20% 3回合 效果"，因此我们需要额外给"精灵王 塞露西亚"给予一个动态技能"必杀后，触发目标受到伤害增加20%（3回合）"来达成，也就是我们的技能"1018"。

*注意：此技能泛指一切会产生数值变化的行为，普攻与防御等会造成数值变化的行为也被归纳为技能*  

### 4. 类型2
必杀技和被动都具有技能等级。  
对于**必杀技**而言，不同等级的必杀技当且仅会启用当前等级的技能，如1绊的"机灵古怪 塞露西亚"只会启用1绊的必杀技"技能ID1001" 。必杀技具体等级定义如下：
1. 1绊
2. 2绊
3. 3绊
4. 4绊
5. 5绊

然而对于**被动而言**，不同等级的被动将会向下继承，即5星的"机灵古怪 塞露西亚"，将会拥有1星被动技能"1012"、3星被动技能"1013"和5星被动技能"1014"。被动具体等级定义如下：
1. 一星
2. 三星
3. 五星
4. 六潜
5. 十二潜

*注意：仅必杀技和被动存在类型2，其余技能不存在技能等级之分*

### 5. 描述（人话）
实际现实在游戏中的人类可读技能描述语言。

### 6. 触发时点
此项为技能触发的时机，具体时机可分为如下几类：
1. 被动光环
2. 游戏开始时
3. 回合开始
4. 释放普攻
5. 释放普攻后
6. 释放必杀
7. 释放必杀后
8. 攻击后
9. 快速普攻追击

其中**被动光环**和**游戏开始时**皆为有且仅有一次启用的技能，但两者触发的时机有先后顺序，被动光环处理将会先于游戏开始时。  
**回合开始**为时点的技能，将会在每回合开始时，被启用一次。  
**释放普攻**与**释放必杀**为普攻技能和必杀技技能特有时点，将会在普攻/必杀时，被启用一次。  
**释放普攻后**、**释放必杀后**和**攻击后**分别为普攻技能后、必杀技能后和普攻技能/必杀技能后特有时点，将会在普攻/必杀效果结算后，被启用一次。对于**攻击后而言**，普攻/必杀技能都会触发此时点。  
**快速普攻追击**为动态技能特有时点，其结算试点在"释放普攻"前，对于"攻击后"释放的BUFF，具有此类时点的伤害无法享受。

### 7. 描述（程序语言）
#### 7.1 DSL语言概要
DSL全称"Domain Specified Language"，中译为"领域专用语言"，此处为FumaSim自定义的语言，其目的为更直观的模拟天下布魔的角色技能。DSL定义的技能现分为3种：
1. 普通技能
2. 激活型技能
3. 以"回合开始"作为时点的技能

其中"激活型技能"和"以'回合开始'作为时点的技能"将分别在7.5和7.6进行介绍，此处将更集中说明"普通技能"，与技能的基本语法。

#### 7.2 技能条件
技能条件一般用于"激活型技能"的条件检测，其语法为：  
`<技能目标><技能条件>`  

`<技能目标>`我们将于7.3详细讨论，此处仅讨论`<技能条件>`。`<技能条件>`通常会跟在`<技能目标>`后对其进行一定对条件判断，其具有对数据类型如下：
1. `有ID为<具体ID>`
2. `数量为<具体数量>`
3. `数量大于<具体数量>`

实例：`队伍中风属性数量为5`中，`队伍中风属性`为`<技能目标>`，`数量为5`则为`<技能条件>`中对第二类型，此处`<具体数量>`值具体为5。

#### 7.3 技能目标
技能目标用于判定技能效果的作用对象，其取值可为：
1. 以"队伍中"开头可用`队伍中<角色职业|角色属性>`
   1. 其中`<角色职业>`取值可为`攻击者`、`治疗者`、`妨碍者`、`辅助者`、`守护者`
   2. 其中`<角色属性>`取值可为`风属性`、`水属性`、`暗属性`、`光属性`、`火属性`
2. 以"a{"或者"e{"开头，并且以"}"结尾，可用于选取具体友方/敌方指定位置上的角色，具体实例为`e{1_3_5}`为选取敌方1、3、5位置上的角色作为技能目标；`a{1_5}`为选取友方1、5位置上的角色作为技能目标。
3. 以"{"并且以"}"结尾，可用于直接选取具体角色名，具体实例为`{精灵王 塞露西亚}`为如果友方阵容中有"精灵王 塞露西亚"则为其添加此技能效果。
4. 以"ID"开头可用`ID<具体ID>`，选取特定ID的角色
5. 其余的具体取值为：
   1. `目标`：技能释放的目标
   2. `自身`：技能释放者
   3. `友方`：技能释放者阵营的全体角色
   4. `敌方全体`：技能释放者敌对阵营的全体角色
   5. `其他友方`：除技能释放者阵营的全体角色

实例：`自身普攻伤害+10%`中，`自身`为`技能目标`，`普攻伤害+10%`为`技能效果`。

#### 7.4 技能效果
技能效果为实际会造成的效果，其可分为以下几类：
1. 伤害计算
2. 角色获得技能
3. BUFF计算

##### 7.4.1 伤害计算
**伤害计算**为实际造成伤害类技能对特有技能，如（必杀技、普攻与时点为"快速普攻追击"的动态技能）。此类效果以"对"开头，其具体语法如下：  
`对<技能目标><伤害百分比><伤害基数类型><伤害类型>`  
其中：
1. `<技能目标>`为技能目标，详情请见7.3
2. `<伤害百分比>`为伤害百分比，例`100%`代表伤害百分比为"100%"
3. `<伤害基数类型>`为伤害百分比基于哪种类型做乘法，现系统支持以下基数：
   1. 若此选项为"空"，即不填任何值，则伤害基数类型为"攻击力"
   2. 若此选项为`自身生命`，则伤害百分比将基于技能释放者的"最大生命值"做乘法
4. `<伤害类型>`为伤害类型，现系统支持以下伤害类型：
   1. 若此选项为`技能伤害`，则此伤害为必杀技造成
   2. 若此选项为`普攻伤害`，则此伤害为普攻造成

实例：`对目标100%普攻伤害`为"对技能目标释放100%的普攻类型伤害"，此处`<技能目标>`为"目标"，`<技能百分比>`为"100%"，`<技能基数类型>`为"攻击力（默认）"，`<伤害类型>`为"普攻伤害"。

##### 7.4.2 角色获得技能
**角色获得技能**将会给角色赋予动态技能（仅允许赋动态技能）。此类效果以效果中带有"获得技能"作为标签，而且赋值的技能必须为"动态技能"，否则将会报错，其具体语法如下：  
`<技能目标>获得技能<动态技能ID><持续回合>`  
其中：
1. `<技能目标>`为技能目标，详情请见7.3
2. `<动态技能ID>`为具体动态技能的ID
3. `<持续回合>`为将此动态技能赋予技能目标多少回合，例，`<技能目标>获得技能7014(2回合)`为"赋予动态技能7014给技能目标5回合"；若此选项为空，则默认回合数为999，即50回合以上持续整场战斗。

实例：`{精灵王 塞露西亚}获得技能1018`为"为'精灵王 塞露西亚'添加动态技能1018"，此处`<技能目标>`为"精灵王 塞露西亚"，`<动态技能ID>`为"1018"，`<持续回合>`为"999(默认)，即整场战斗"。

##### 7.4.3 BUFF计算
**BUFF计算**将会给角色赋予BUFF效果，也是天下布魔最常见的技能效果，其具体语法如下：  
`<技能目标><BUFF类型><百分比数值><持续回合><最大层数>`  
其中：
1. `<技能目标>`为技能目标，详情请见7.4
2. `<BUFF类型>`为技能BUFF类型，当前版本支持的技能BUFF类型如下：
   1. `普攻伤害`，`必杀技伤害`，`造成伤害`分别为普攻/必杀技的伤害数值变化
   2. `受到普攻伤害`，`受到伤害`分别为易普攻伤害/易伤
   3. `受到自身伤害`为部分角色特有如"小恶魔 布兰妮"的"使目标受到小恶魔布兰妮伤害增加xx%"
   4. `攻击力`和`攻击力数值`分别对应着"**使**xx攻击力增加yy%"和"**以**自身攻击力yy%使xx攻击力增加"两种不同的加法，"攻击力"为基础攻击力百分比，"攻击力数值"为当前攻击力具体数值
3. `<百分比数值>`为数值变化的百分比（含"+"，"-"符号），例`+100%`代表增加"100%"，而`-100%`代表减少"100%"
4. `<持续回合>`为此BUFF将会持续多少回合，例，`友方普攻伤害+7.5%(1回合)`为"友方全体普攻伤害增加7.5%，持续1回合"
5. `<最大层数>`为此BUFF最大可以叠加多少层，例，`队伍中风属性造成伤害+15%(最多2层)`为"队伍中风属性角色造成伤害+15%，最大可以叠加2层，持续整场战斗"

实例1:`对目标330%技能伤害，目标受到自身伤害+10%(最多2层)`为"以自身攻击力330%对目标造成伤害，使目标受到小恶魔伤害+10%（2层）"  
实例2:`a{1}攻击力数值+15%(1回合)`为"攻击时，触发'以自身攻击力15%使我方站位1角色攻击力增加(1回合)'(50回合)"  
实例3:`其他友方获得技能35011,其他友方获得技能35012`为"使自身以外的我方全体队员获得《臣服于王》"，其中"35011"和"35012"分别为"获得《臣服于王》的角色释放必杀"和"获得《臣服于王》的角色释放防御"的动态技能。  
实例3.1:获得《臣服于王》的角色释放必杀时`目标受到火属性伤害+6%(2回合),目标受到水属性伤害+6%(2回合),目标受到风属性伤害+6%(2回合),目标受到光属性伤害+6%(2回合),目标受到暗属性伤害+6%(2回合)`。  
实例3.2:获得《臣服于王》的角色释放防御时`目标受到火属性伤害+6%(2回合),目标受到水属性伤害+6%(2回合),目标受到风属性伤害+6%(2回合),目标受到光属性伤害+6%(2回合),目标受到暗属性伤害+6%(2回合)`。  

#### 7.5 激活型技能
当技能以"如果"开头时，此技能将会被识别为激活型技能，激活型语法为：  
`如果<激活条件>则<技能效果>`  
其中：
1. `<激活条件>`为技能激活的条件，其语法为`<目标><条件>`
2. `<技能效果>`为技能效果

实例：`如果队伍中风属性数量为5则友方攻击力+100%`意为"队伍中有5名风属性角色时，发动全体攻击力增加100%效果"

#### 7.6 特殊：时点为"回合开始"的技能
当技能触发时点为"回合开始"时，角色技能将会有特殊的语法：  
`<循环回合>N+<起始回合>回合触发：<技能效果>`  
其中：  
1. `<循环回合>`为多少回合启用一次技能
2. `<起始回合>`为多少回合开始记录启用技能循环
3. `<技能效果>`为技能效果  

实例：`3N+1回合触发:目标受到伤害+35%(1回合)`意为"每经过3回合，触发"使目标受到伤害增加35%(1回合)"效果"



